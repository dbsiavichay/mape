{% extends 'base.html' %}
{% load staticfiles %}

{% block css %}
    <link href="{% static 'showcase/css/map.css' %}" rel="stylesheet">    
    <link href="{% static 'plugins/clockpicker/clockpicker.css' %}" rel="stylesheet">
{% endblock %}



{% block content %}
{% include 'includes/nav.html' %}
<!-- Parallax -->
<div class="parallax-container no-padding fullscreen">
<h3 class="header sombra grey-text text-lighten-3 center-align">{{ object.name }}</h3>
{% if  object.front_image %}    
  <div class="parallax "><img class="opacado" src="{{ object.front_image.url }}" width="100%"></div>
{% else %}
  <div class="parallax "><img src="{% static 'showcase/img/event-header.jpg' %}" width="100%"></div>
{% endif %}
</div>

<!-- Informacion extra -->
<div class="right-align fringe tiny-text low-border">
    {% for category in object.categories.all %}
    {{ category.name }} &#8226;
    {% endfor %}
    <!-- si es publico o privado -->
    {% if object.is_public %}
    Publico &#8226;
    {% else %}
    Privado &#8226;
    {%endif%}
    <!-- si esta abierto -->
    Abierto &#8226;
    <!-- Si esta verificado-->
    {% if object.verified %}
    Verificado
    {% endif %}
    ingresado: {{ object.date_joined|date }}
</div>
<!-- boton de editar -->

<div class="right">
{% if object.owner == user.profile %}
<a href="{% url 'locality_update' object.id %}" class="waves-effect waves-light cyan btn">Mapa <i class="material-icons tiny">location_on</i></a>
<a href="{% url 'locality_update' object.id %}" class="waves-effect waves-cyan btn-flat">Editar</a>
{%endif%}
</div>


<!-- Seccion central -->
<div class="section white no-padding row">
    <div class="card">
    <!-- Cabecera de la localidad -->
        <div class="card-content row fullscreen">
            <div class="card col s12 m12 l6 row ">
            <!-- Imagen de perfil -->
                {% if  object.profile_image %}                    
                <div class="col center-align col s6 l4 m4">
                    <img class="event responsive-img circle" src="{{ object.profile_image.url }}" >
                </div>
                {% endif %}
                <h4 class="grey-text"> #{{ object.name }} </h4>
                
                <div class="left-align">
                    {% if not user.is_anonymous %}
                      {% if is_subscribed or object.owner == user.profile %}
                    <button class="btn amber darken-3" type="submit" class="waves-effect waves-light btn"><i class="material-icons right">grade</i>Suscrito</button>
                      {% else %}
                    <form action="/subscriber/add/" method="POST" enctype="multipart/form-data" novalidate>
                      {% csrf_token %}
                      <input type="hidden" name="profile" value="{{ user.profile.id }}">
                      <input type="hidden" name="contenttype" value="{{ contenttype.id }}">
                      <input type="hidden" name="object_id" value="{{ object.id }}">
                      <input type="hidden" name="next" value="/locality/{{ object.id }}/">
                      <button type="submit" class=" cyan waves-effect waves-light btn"><i class="material-icons">grade</i>Subscribirse</button>    
                    </form>
                      {% endif %}
                    {% endif %}
                    <!-- Contador de suscriptores -->                        
                    <p class="flow-text"> {{ object.subscribers_count }} Suscriptores</p>
                    {% if not object.is_commercial %}
                    <span class="card-title grey-text">Ingresado por:</span>
                    <div class="chip">
                        <img src="{{ object.owner.avatar.url }}" alt="Contact Person">
                        <a href="">{{ object.owner.user }}</a>
                    </div>
                    {% endif %}
                </div>                    
            </div>
            <div class="divider col"></div>
            <!-- Imagenes -->
            {%if object.profile_image or front_image %}
            <div class="black carousel col s12 m12 l6">

              {%if object.profile_image %}
                <a target="_blank" class="carousel-item" href="{{ object.profile_image.url }}">
                    <img src="{{ object.profile_image.url }}">
                </a>
              {%endif%}
              {% if object.front_image %}
                <a target="_blank" class="carousel-item" href="{{ object.front_image.url }}">
                    <img src="{{ object.front_image.url }}">
                </a>
              {% endif %}
                {% for comment in object.comments %}
                {% if comment.image %}
                <a target="_blank" class="carousel-item" href="{{ comment.image.url }}">
                    <img src="{{ comment.image.url }}">
                </a>
                {% endif %}
                {% endfor %}
            </div>
            {%endif%}
        </div>

        <!-- Tabs de la tarjeta -->
        <div class="card-tabs">
            <ul class="tabs tabs-fixed-width">
              <li class="tab"><a class="active" href="#description">Descripci√≥n</a></li>
              <li class="tab {% if object.event_set %} disabled {%endif%}"><a href="#events">Eventos</a></li>
            </ul>
        </div>
        <!-- Contenido de los tabs -->
        <div class="card-content row grey lighten-4">
          <div id="description row">
            <!-- Descripcion -->
            <div class="card-panel col s12">
              <span class="card-title">{{ object.name }}</span>
              <p align="justify"><span>{{ object.description }}</span></p>
            </div>
            <!-- Productos / Servicios-->            
            {% if object.is_commercial %}
            <p class="grey-text"> Ofrece:</p>
              {% for offer in  object.commercial.offer_set.all %}
            <div class="card col l3 m4 s12 {% if offer.kind == 1 %} product {% else %} service {% endif %} no-padding">
                {% if offer.image %}
              <div class="card-image waves-effect waves-block waves-light">
                <img class="activator" src="{{ offer.image.url }}">
                  {% elif offer.kind == 2 %}
              <div class="activator waves-effect waves-block waves-light">
                  <i class="opacado material-icons mape-medium large">room_service</i>
                  {% elif offer.kind == 1 %}
              <div class="activator waves-effect waves-block waves-light">
                  <i class="opacado material-icons large ">local_mall</i>
                {% endif %}
                <span class="activator card-title sombra white-text">{{ offer.name }}</span>
              </div>
              <div class="card-content">
                <span class="activator right white-text link">{{ offer.price }}</span>
              </div>
              <div class="card-reveal">
                <span class="card-title grey-text text-darken-4">{{ offer.get_kind }}<i class="material-icons right">close</i></span>
                <p>{{ offer.description }}</p>
              </div>
            </div>
              {% endfor %}
            {% endif %}
            
            {% if object.commercial %}
            <!-- Grupo de colacoracion en la localidad -->
            <div class="card-panel grey lighten-3 col s12">
              <span class="card-title grey-text">Administrado por:</span>
              <div class="chip  z-depth-1 {% if object.commercial. %} amber lighten-3 {% endif %}">
                  {% if object.owner.avatar %}
                  <img src="{{ object.owner.avatar.url }} " alt="Contact Person">
                  {% else %}
                  <i class="material-icons cyan circle">link</i>
                  {% endif %}
                  <a href="/profile/{{ object.owner.id }} ">{{ object.owner.get_full_name }} </a>
              </div>
            </div>
            {% endif %}
            <!-- Informacion Comercial -->              
            {% include 'showcase/components/commercial_info.html' with commercial=object.commercial %}
            
            
          </div>
          <!-- Media 
          <div id="media" class="row">
              <div class="col s12 ">
                  {% for comment in object.comments %}
                  {% if comment.image %}
                  <div class="col s2">
                      <img class="materialboxed" style="width: 100%" src="{{ comment.image.url }}">
                  </div>
                  {% endif %}
                  {% endfor %}
              </div>
          </div> -->
          <!-- Eventos de la Localidad -->
          {% if eventos %}
          <div id="events" class="row">
            <div class="section col s12 m12 l6 offset-l3">
              <!-- Tarjeta de evento -->
              {% include 'includes/event_card.html'%}
            </div>
          </div> 
          {% endif %}
        </div><!-- Fin tarjeta evento -->
    </div>
    <!-- Comentarios -->
    <div class="section col s12 m8 l8 offset-m2 offset-l2">
        {% include 'includes/comments.html' with comments=object.comments model_name="locality" model_id=object.id %}        
    </div>
</div>
        {% include 'includes/footer.html' %}
{% endblock %}

{% block js %}
    <script src="{% static 'plugins/clockpicker/clockpicker.js' %}"></script>
    <script src="{% static 'showcase/js/rango-jquery.js' %}"></script> 
{% endblock %}